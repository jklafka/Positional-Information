---
title: Wikipedia Text Mining and Surprisal Analysis
author: Josef Klafka and Dan Yurovsky
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: false
    number_sections: false
    theme: lumen
    toc_float: false
    code_folding: show 
---

```{r setup, include=FALSE}
library(tidyverse)
library(tidytext)
library(childesr)

knitr::opts_chunk$set(echo = TRUE)
```


```{r prov}
prov_utterances <- get_utterances(corpus = "Providence")

adult_utterances <- prov_utterances %>%
  filter(speaker_role != "Target_Child") %>% 
  mutate(utterance_id = 1:n()) %>% 
  unnest_tokens(word, gloss, token = stringr::str_split, pattern = "[ +]+") %>%
  unnest_tokens(letter, word, token = stringr::str_split, pattern = "", drop = F) %>%
  group_by(utterance_id, word) %>%
  mutate(letter_order = 1:n()) %>%
  mutate(word_length = max(letter_order)) %>%
  ungroup()
  
letter_probs <- adult_utterances %>% 
  count(letter) %>%
  ungroup() %>%
  mutate(p = n/sum(n))

letter_unigrams <- adult_utterances %>% 
  left_join(letter_probs) %>%
  mutate(s = -log(p)) %>%
  group_by(word_length, letter_order) %>%
  summarise(mean_s = mean(s))



letter_unigrams %>%
  filter(word_length %in% 3:11) %>%
  ggplot(aes(x = letter_order, y = mean_s)) + 
    facet_wrap(~word_length) + 
    geom_point() +
    geom_line() + 
    xlab("Letter Position") + 
    ylab("Mean surprisal")
    
```